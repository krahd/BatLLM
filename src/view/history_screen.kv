#:kivy 2.3.1
#:import dp kivy.metrics.dp
#:import MDLabel kivymd.uix.label.MDLabel

<HistoryScreen>:
    # paint the whole background white
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"
        padding: dp(0)
        spacing: dp(0)

        # Title
        Label:
            text: ""
            id: title_label
            bold: True
            font_size: "34sp"
            size_hint_y: None
            height: self.texture_size[1] + dp(40)
            color: 1, 1, 1, 1
            canvas.before:
                Color:
                    rgba: .61, .61, .66, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            canvas.after:
                Color:
                    rgba: 0, 0, 0, 1
                Line:
                    points: self.x, self.y, self.right, self.y
                    width: dp(1)

        BoxLayout:
            orientation: "horizontal"
            spacing: dp(30)

            # — Raw Prompt / String Panel —
            RecycleView:
                id: rv_string_panel
                viewclass: "MarkupLabel"
                size_hint_x: .5
                bar_width: dp(10)
                scroll_type: ["bars", "content"]
                do_scroll_x: False
                do_scroll_y: True

                # white background behind all items
                canvas.before:
                    Color:
                        rgba: 1, .95, .95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                RecycleBoxLayout:
                    default_size_hint: 1, None
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(4)
                    padding: dp(14)

            # — Parsed History Panel —
            RecycleView:
                id: rv_history_panel
                viewclass: "MarkupLabel"
                size_hint_x: .5
                bar_width: dp(10)
                scroll_type: ["bars", "content"]
                do_scroll_x: False
                do_scroll_y: True

                canvas.before:
                    Color:
                        rgba: .95, .95, 1, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                RecycleBoxLayout:
                    default_size_hint: 1, None
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(14)
                    spacing: dp(4)

        Button:
            text: "Back"
            font_size: "16sp"
            size_hint_y: None
            height: dp(40)
            on_press: root.go_back_home()


<MarkupLabel@MDLabel>:
    # extends KivyMD's MDLabel to enable bbcode and selection
    markup: True
    selectable: True
    padding: 0, 0 # dp(2), dp(2)
    text_size: self.width, None
    size_hint_y: None
    height: max(self.texture_size[1], self.font_size)
    valign: 'top'
    halign: 'left'
    theme_text_color: "Custom"
    text_color: 0, 0, 0, 1